# Pre-commit hooks for ProjectGoat
# Full-stack code quality automation (Backend + Frontend)
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Manual run:
#   pre-commit run --all-files

repos:
  # ========================================
  # PYTHON/BACKEND HOOKS
  # ========================================

  - repo: https://github.com/psf/black
    rev: 24.1.1
    hooks:
      - id: black
        name: Format Python code (Black)
        language_version: python3.11
        files: ^backend/.*\.py$

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: Sort Python imports (isort)
        args: ["--profile", "black", "--line-length", "100"]
        files: ^backend/.*\.py$

  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        name: Lint Python code (flake8)
        args: ["--config=.flake8"]
        files: ^backend/.*\.py$
        additional_dependencies:
          - flake8-bugbear
          - flake8-comprehensions

  # Uncomment to enable strict type checking
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.8.0
  #   hooks:
  #     - id: mypy
  #       name: Type check Python (mypy)
  #       args: ["--config-file=pyproject.toml"]
  #       files: ^backend/.*\.py$
  #       additional_dependencies:
  #         - types-all

  # ========================================
  # JAVASCRIPT/TYPESCRIPT/REACT HOOKS
  # ========================================

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: Format frontend code (Prettier)
        types_or: [javascript, jsx, ts, tsx, css, json, yaml, markdown]
        exclude: ^(package-lock\.json|backend/)

  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v9.0.0-beta.2
    hooks:
      - id: eslint
        name: Lint TypeScript/React (ESLint)
        files: ^src/.*\.(ts|tsx|js|jsx)$
        types: [file]
        args: ["--fix", "--max-warnings=0"]
        additional_dependencies:
          - eslint@latest
          - typescript@latest
          - "@typescript-eslint/parser@latest"
          - "@typescript-eslint/eslint-plugin@latest"

  # ========================================
  # GENERAL FILE QUALITY HOOKS
  # ========================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Fix common issues
      - id: trailing-whitespace
        name: Remove trailing whitespace
        args: [--markdown-linebreak-ext=md]

      - id: end-of-file-fixer
        name: Ensure files end with newline

      - id: mixed-line-ending
        name: Fix mixed line endings
        args: [--fix=lf]

      # Validation checks
      - id: check-yaml
        name: Validate YAML syntax
        exclude: ^\.github/

      - id: check-json
        name: Validate JSON syntax

      - id: check-toml
        name: Validate TOML syntax

      # Safety checks
      - id: check-added-large-files
        name: Prevent large files (>500KB)
        args: [--maxkb=500]
        exclude: ^(package-lock\.json|frontend/package-lock\.json)

      - id: check-merge-conflict
        name: Check for merge conflict markers

      - id: check-case-conflict
        name: Check for case conflicts in filenames

      # Python-specific
      - id: check-ast
        name: Validate Python AST
        files: \.py$

      - id: debug-statements
        name: Check for debugger imports
        files: \.py$

  # ========================================
  # SECURITY HOOKS (Optional but recommended)
  # ========================================

  # Uncomment to enable secret detection
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.4.0
  #   hooks:
  #     - id: detect-secrets
  #       name: Detect secrets and credentials
  #       args: ['--baseline', '.secrets.baseline']
  #       exclude: ^(package-lock\.json|\.pre-commit-config\.yaml)

# Configuration
default_language_version:
  python: python3.11
  node: system

# Performance optimization
fail_fast: false  # Run all hooks even if one fails (better feedback)

# Exclude patterns (applies to all hooks unless overridden)
exclude: |
  (?x)^(
    \.venv/|
    venv/|
    env/|
    node_modules/|
    build/|
    dist/|
    \.git/|
    __pycache__/|
    .*\.egg-info/|
    \.pytest_cache/|
    \.mypy_cache/
  )
