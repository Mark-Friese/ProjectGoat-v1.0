# Pre-commit hooks for ProjectGoat
# Full-stack code quality automation (Backend + Frontend)
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Manual run:
#   pre-commit run --all-files

repos:
  # ========================================
  # PYTHON/BACKEND HOOKS
  # ========================================

  - repo: https://github.com/psf/black
    rev: 25.11.0
    hooks:
      - id: black
        name: Format Python code (Black)
        language_version: python3
        files: ^backend/.*\.py$

  - repo: https://github.com/pycqa/isort
    rev: 7.0.0
    hooks:
      - id: isort
        name: Sort Python imports (isort)
        args: ['--profile', 'black', '--line-length', '100']
        files: ^backend/.*\.py$

  - repo: https://github.com/pycqa/flake8
    rev: 7.3.0
    hooks:
      - id: flake8
        name: Lint Python code (flake8)
        args: ['--config=.flake8']
        files: ^backend/.*\.py$
        additional_dependencies:
          - flake8-bugbear
          - flake8-comprehensions

  # Uncomment to enable strict type checking
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.8.0
  #   hooks:
  #     - id: mypy
  #       name: Type check Python (mypy)
  #       args: ["--config-file=pyproject.toml"]
  #       files: ^backend/.*\.py$
  #       additional_dependencies:
  #         - types-all

  # ========================================
  # JAVASCRIPT/TYPESCRIPT/REACT HOOKS
  # ========================================

  # Frontend hooks using local npm packages (works better on Windows)
  # TEMPORARILY DISABLED - npm cache issues on Windows
  # Uncomment when ready to use, or run manually: npx prettier --write src/ && npx eslint --fix src/
  # - repo: local
  #   hooks:
  #     - id: prettier
  #       name: Format frontend code (Prettier)
  #       entry: npx prettier --write
  #       language: system
  #       types_or: [javascript, jsx, ts, tsx, css, json, yaml, markdown]
  #       exclude: ^(package-lock\.json|backend/|\.md$)
  #
  #     - id: eslint
  #       name: Lint TypeScript/React (ESLint)
  #       entry: npx eslint --fix --max-warnings=0
  #       language: system
  #       files: ^src/.*\.(ts|tsx|js|jsx)$
  #       types: [file]

  # ========================================
  # GENERAL FILE QUALITY HOOKS
  # ========================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      # Fix common issues - BACKEND ONLY
      - id: trailing-whitespace
        name: Remove trailing whitespace (backend only)
        args: [--markdown-linebreak-ext=md]
        files: ^backend/.*

      - id: end-of-file-fixer
        name: Ensure files end with newline (backend only)
        files: ^backend/.*

      - id: mixed-line-ending
        name: Fix mixed line endings (backend only)
        args: [--fix=lf]
        files: ^backend/.*

      # Validation checks - BACKEND ONLY
      - id: check-yaml
        name: Validate YAML syntax
        files: ^backend/.*\.ya?ml$

      - id: check-json
        name: Validate JSON syntax
        files: ^backend/.*\.json$

      - id: check-toml
        name: Validate TOML syntax
        files: ^(backend/.*\.toml|pyproject\.toml)$

      # Safety checks - BACKEND ONLY
      - id: check-added-large-files
        name: Prevent large files (>500KB)
        args: [--maxkb=500]
        files: ^backend/.*

      - id: check-merge-conflict
        name: Check for merge conflict markers (backend only)
        files: ^backend/.*

      - id: check-case-conflict
        name: Check for case conflicts in filenames (backend only)
        files: ^backend/.*

      # Python-specific
      - id: check-ast
        name: Validate Python AST
        files: ^backend/.*\.py$

      - id: debug-statements
        name: Check for debugger imports
        files: ^backend/.*\.py$

  # ========================================
  # SECURITY HOOKS (Optional but recommended)
  # ========================================

  # Uncomment to enable secret detection
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.4.0
  #   hooks:
  #     - id: detect-secrets
  #       name: Detect secrets and credentials
  #       args: ['--baseline', '.secrets.baseline']
  #       exclude: ^(package-lock\.json|\.pre-commit-config\.yaml)

# Configuration
default_language_version:
  python: python3
  node: system

# Performance optimization
fail_fast: false # Run all hooks even if one fails (better feedback)

# Exclude patterns (applies to all hooks unless overridden)
exclude: |
  (?x)^(
    \.venv/|
    venv/|
    env/|
    node_modules/|
    build/|
    dist/|
    \.git/|
    __pycache__/|
    .*\.egg-info/|
    \.pytest_cache/|
    \.mypy_cache/
  )
